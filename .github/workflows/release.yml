name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF_NAME#v}" >> $GITHUB_OUTPUT

      - name: Package extension
        run: |
          ZIP_NAME="prompt_one_by_one_${GITHUB_REF_NAME}.zip"
          zip -r "${ZIP_NAME}" \
            manifest.json \
            automation.js \
            sidebar.js \
            sidebar.css \
            README.md
          echo "ZIP_NAME=${ZIP_NAME}" >> $GITHUB_OUTPUT
        id: package

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          name: "ğŸ¨ ${{ github.ref_name }} â€” Gemini æ‰¹é‡ç”Ÿå›¾æ’ä»¶"
          files: ${{ steps.package.outputs.ZIP_NAME }}
          body: |
            ## å®‰è£…æ–¹æ³• / How to Install

            1. ä¸‹è½½ä¸‹æ–¹ `${{ steps.package.outputs.ZIP_NAME }}` å¹¶è§£å‹
            2. æ‰“å¼€ `chrome://extensions/` â†’ å¼€å¯å¼€å‘è€…æ¨¡å¼
            3. ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€é€‰æ‹©è§£å‹åçš„æ–‡ä»¶å¤¹
            4. æ‰“å¼€ [gemini.google.com](https://gemini.google.com) å³å¯ä½¿ç”¨

            ---

            1. Download `${{ steps.package.outputs.ZIP_NAME }}` below and unzip
            2. Open `chrome://extensions/` â†’ Enable Developer mode
            3. Click "Load unpacked" and select the folder
            4. Open [gemini.google.com](https://gemini.google.com) to use
